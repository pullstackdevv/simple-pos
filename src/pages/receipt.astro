---
import Layout from '../layouts/Layout.astro';
---

<Layout>
	<div class="min-h-screen bg-gradient-to-br from-green-50 via-blue-50 to-gray-100 p-4 md:p-6 flex items-center justify-center">
		<div class="w-full max-w-md">
			<div class="bg-white rounded-2xl shadow-2xl p-8 border border-gray-100">
				<!-- Success Icon -->
				<div class="text-center mb-8">
					<div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full mb-4 shadow-lg">
						<svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
						</svg>
					</div>
					<h1 class="text-3xl font-black bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent mb-1">
						☕ Simple POS
					</h1>
					<p class="text-gray-600 font-semibold">STRUK PEMBAYARAN</p>
					<p class="text-green-600 font-bold text-sm mt-2">✓ Pembayaran Berhasil</p>
				</div>

				<!-- Receipt Content -->
				<div id="receipt-content" class="space-y-4 bg-gray-50 rounded-xl p-6 mb-6 border border-gray-200">
					<!-- Receipt will be populated by JavaScript -->
				</div>

				<!-- Action Buttons -->
				<div class="space-y-3">
					<button
						id="print-btn"
						class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl flex items-center justify-center gap-2"
					>
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4H9a2 2 0 00-2 2v2a2 2 0 002 2h10a2 2 0 002-2v-2a2 2 0 00-2-2h-2m-4-4V9m0 4v6m0-6H9m4 0h4"></path>
						</svg>
						Cetak Struk
					</button>
					<button
						id="new-transaction-btn"
						class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl flex items-center justify-center gap-2"
					>
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
						</svg>
						Transaksi Baru
					</button>
				</div>

				<!-- Footer -->
				<div class="text-center mt-6 text-gray-500 text-xs border-t pt-4">
					<p>Terima kasih telah berbelanja</p>
					<p class="mt-1">Selamat datang kembali</p>
				</div>
			</div>
		</div>
	</div>
</Layout>

<script>
	interface ReceiptData {
		items: Array<{ name: string; price: number; quantity: number }>;
		subtotal: number;
		tax: number;
		total: number;
		timestamp: string;
	}

	const loadReceipt = () => {
		const receiptData = localStorage.getItem('pos-receipt');

		if (!receiptData) {
			window.location.href = '/';
			return;
		}

		const receipt: ReceiptData = JSON.parse(receiptData);
		const receiptContent = document.getElementById('receipt-content') as HTMLElement;

		const date = new Date(receipt.timestamp);
		const dateStr = date.toLocaleDateString('id-ID', {
			year: 'numeric',
			month: 'long',
			day: 'numeric',
			hour: '2-digit',
			minute: '2-digit',
		});

		let html = `
      <div class="text-xs text-gray-500 text-center mb-4 pb-4 border-b border-gray-300">
        <p class="font-semibold">${dateStr}</p>
      </div>

      <div class="space-y-3 mb-4">
    `;

		receipt.items.forEach((item) => {
			html += `
        <div class="flex justify-between items-start text-sm">
          <div class="flex-1">
            <p class="font-bold text-gray-800">${item.name}</p>
            <p class="text-xs text-gray-500">${item.quantity}x @ Rp ${item.price.toLocaleString('id-ID')}</p>
          </div>
          <p class="font-bold text-gray-800 ml-2">Rp ${(item.price * item.quantity).toLocaleString('id-ID')}</p>
        </div>
      `;
		});

		html += `
      </div>

      <div class="border-t border-gray-300 pt-3 space-y-2 text-sm">
        <div class="flex justify-between text-gray-700">
          <span>Subtotal:</span>
          <span class="font-semibold">Rp ${receipt.subtotal.toLocaleString('id-ID')}</span>
        </div>
        <div class="flex justify-between text-gray-700">
          <span>Pajak (10%):</span>
          <span class="font-semibold">Rp ${receipt.tax.toLocaleString('id-ID')}</span>
        </div>
        <div class="flex justify-between text-base font-black text-blue-600 border-t border-gray-300 pt-3 mt-3">
          <span>TOTAL:</span>
          <span>Rp ${receipt.total.toLocaleString('id-ID')}</span>
        </div>
      </div>
    `;

		receiptContent.innerHTML = html;
	};

	// Print functionality
	const printBtn = document.getElementById('print-btn');
	if (printBtn) {
		printBtn.addEventListener('click', () => {
			window.print();
		});
	}

	// New transaction
	const newTransactionBtn = document.getElementById('new-transaction-btn');
	if (newTransactionBtn) {
		newTransactionBtn.addEventListener('click', () => {
			localStorage.removeItem('pos-receipt');
			localStorage.removeItem('pos-cart');
			window.location.href = '/';
		});
	}

	// Load receipt on page load
	loadReceipt();
</script>

<style>
	@media print {
		body {
			background: white;
		}

		.min-h-screen {
			background: white;
			padding: 0;
		}

		.w-full {
			width: 100%;
		}

		.max-w-md {
			max-width: 100%;
		}

		.bg-white {
			box-shadow: none;
			border: none;
		}

		#print-btn,
		#new-transaction-btn {
			display: none;
		}
	}
</style>
